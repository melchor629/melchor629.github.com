// Generated by CoffeeScript 1.10.0
(function() {
  var apiKey, apiUrl, buildUrl, doRequest, extend, flickr, protoFunc, randomString;

  apiKey = 'a901b91486eb90e967465d6df5f96ea1';

  apiUrl = 'https://api.flickr.com/services/rest/';

  randomString = function() {
    var i, j, num, rand, str;
    rand = function() {
      return Math.round(Math.random() * 1000000);
    };
    str = '';
    for (i = j = 0; j <= 8; i = ++j) {
      num = Math.random() % 3;
      if (num === 0) {
        str += String.fromCharCode((rand() % 26) + 97);
      } else if (num === 1) {
        str += String.fromCharCode((rand() % 26) + 65);
      } else {
        str += String.fromCharCode((rand() % 10) + 48);
      }
    }
    return str;
  };

  doRequest = function(request, cbk) {
    var rndCbk, script;
    rndCbk = 'flickr_' + randomString();
    request = extend(request, {
      api_key: apiKey,
      format: 'json',
      jsoncallback: rndCbk
    });
    window[rndCbk] = function(json) {
      cbk(json);
      return delete window[rndCbk];
    };
    script = document.createElement('script');
    script.src = buildUrl(apiUrl, request);
    document.head.appendChild(script);
    return document.head.removeChild(script);
  };

  buildUrl = function(url, parameters) {
    var key, queryString;
    queryString = '';
    for (key in parameters) {
      if (parameters.hasOwnProperty(key)) {
        queryString += encodeURIComponent(key) + '=' + encodeURIComponent(parameters[key]) + '&';
      }
    }
    if (queryString.lastIndexOf('&') === queryString.length - 1) {
      queryString = queryString.substring(0, queryString.length - 1);
    }
    return url + '?' + queryString;
  };

  extend = function(object) {
    var arg, j, key, len;
    for (j = 0, len = arguments.length; j < len; j++) {
      arg = arguments[j];
      for (key in arg) {
        if (arg.hasOwnProperty(key)) {
          object[key] = arg[key];
        }
      }
    }
    return object;
  };

  protoFunc = function(meth) {
    return function(params, callback) {
      return doRequest(extend(params, {
        method: meth
      }), callback);
    };
  };

  flickr = {
    galleries: {
      getPhotos: protoFunc('flickr.galleries.getPhotos')
    },
    photos: {
      getInfo: protoFunc('flickr.photos.getInfo'),
      getExif: protoFunc('flickr.photos.getExif'),
      getSizes: protoFunc('flickr.photos.getSizes')
    },
    photosets: {
      getPhotos: protoFunc('flickr.photosets.getPhotos'),
      getList: protoFunc('flickr.photosets.getList')
    },
    buildThumbnailUrl: function(photo) {
      return "https://farm" + photo.farm + ".staticflickr.com/" + photo.server + "/" + photo.id + "_" + photo.secret + "_q.jpg";
    },
    buildPhotoUrl: function(photo) {
      return "https://farm" + photo.farm + ".staticflickr.com/" + photo.server + "/" + photo.id + "_" + photo.secret + ".jpg";
    },
    buildLargePhotoUrl: function(photo) {
      return "https://farm" + photo.farm + ".staticflickr.com/" + photo.server + "/" + photo.id + "_" + photo.secret + "_b.jpg";
    }
  };

  window.flickr = flickr;

}).call(this);
