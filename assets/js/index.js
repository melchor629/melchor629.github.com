// Generated by CoffeeScript 1.9.2
(function() {
  var a, addKey, audioCtx, años, c, canPlay, createCheat, loadSound, playSound, removeKeys, soundBuffers;

  addKey = function(key) {
    return $('.keys').append("<div class=\"key\"> " + key + " </div>").removeClass('hidden');
  };

  removeKeys = function() {
    $('.keys').find('.key').addClass('bye');
    return setTimeout(function() {
      return $('.keys').addClass('hidden').empty();
    }, 300);
  };

  createCheat = function(cheatStr, done) {
    return cheet(cheatStr, {
      next: function(str, key, num, seq) {
        return addKey(key);
      },
      fail: function() {
        return removeKeys();
      },
      done: function() {
        done();
        return setTimeout(function() {
          return removeKeys();
        }, 1000);
      }
    });
  };

  createCheat('↑ ↑ ↓ ↓ ← → ← → b a', function() {
    return alert('Voilà!');
  });

  createCheat('f i l l space d e space p u t a', function() {
    return alert('Com goses insultarme? Fill de meuca, al infern aniràs...');
  });

  createCheat('a r o u n d space t h e space w o r l d', function() {
    return playSound('atw');
  });

  años = function() {
    var año, d, n;
    d = new Date;
    n = new Date(830037600000);
    if (d.getMonth() > n.getMonth() || (d.getMonth() === n.getMonth() && d.getDate() >= n.getDate())) {
      año = d.getYear() - n.getYear();
    } else {
      año = d.getYear() - n.getYear() - 1;
    }
    return $('#año').text(año);
  };

  años();

  window.soundBuffers = soundBuffers = {};

  window.AudioContext = window.webkitAudioContext || window.AudioContext;

  window.audioCtx = audioCtx = new AudioContext();

  a = new Audio;

  canPlay = {
    mp4: a.canPlayType('audio/m4a; codecs="mp4a.40.5'),
    mp3: a.canPlayType('audio/mp3'),
    ogg: a.canPlayType('audio/ogg; codecs="vorbis"')
  };

  for (c in canPlay) {
    if (canPlay[c]) {
      canPlay.def = c;
    }
  }

  loadSound = function(name, snd) {
    var file, request;
    file = snd || ("/assets/snd/" + name + "." + canPlay.def);
    request = new XMLHttpRequest();
    request.open('GET', file);
    request.responseType = 'arraybuffer';
    request.onload = function(e) {
      return audioCtx.decodeAudioData(request.response, function(buffer) {
        return soundBuffers[name] = buffer;
      });
    };
    request.onerror = function(e) {
      return console.error('El archivo ' + file + ' no existe');
    };
    return request.send();
  };

  playSound = function(name) {
    var buffer, source;
    buffer = soundBuffers[name];
    if (!buffer) {
      return window.alert('Buffer is null or undefined');
    } else {
      source = audioCtx.createBufferSource();
      source.buffer = buffer;
      source.connect(audioCtx.destination);
      return setTimeout(function() {
        return source.start(0);
      }, 100);
    }
  };

  loadSound('atw');

}).call(this);
