(function(){var e,n,r,t,o,a,i,u,l,d,s,c,f,g,p;window.AudioContext=window.AudioContext||window.mozAudioContext||window.webkitAudioContext,window.audioCtx=t=new AudioContext,window.soundAnalyser=t.createAnalyser(),soundAnalyser.maxDecibels=-5,d=null,r=null,c=null,o=$("#background")[0].getContext("2d"),soundAnalyser.connect(t.destination),n=$("<audio/>")[0],f=0,g=0,$("#cancion").change(function(e){return e.preventDefault(),l(e.target.files[0]),!1}),$("body").on("drop",function(e){return e.stopPropagation(),e.preventDefault(),l(e.originalEvent.dataTransfer.files[0]),$(".arrastrar").stop().animate({opacity:0},500),$(".arrastrar").data("dragover",null),!1}),$("body").on("dragover",function(e){return e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",$(".arrastrar").data("dragover")||($(".arrastrar").stop().animate({opacity:1},300),$(".arrastrar").data("dragover","yep")),!1}),$("body").on("dragleave",function(e){return e.stopPropagation(),e.preventDefault(),$(".arrastrar").stop().animate({opacity:0},500),$(".arrastrar").data("dragover",null),!1}),$("#visualizador").change(function(e){switch(d&&window.cancelAnimationFrame(d),d=null,Number($("#visualizador").val())){case 1:return a();case 2:return i()}}),$("#play").click(function(e){return u()}),$("#stop").click(function(e){return p()}),$("#pos").mousedown(function(e){return p(!0),$("#pos").attr("disabled",null)}),$("#pos").mouseup(function(e){return u(Number($("#pos").val()))}),l=function(e){var o;return console.log(e),-1===e.type.indexOf("audio/")?(console.error("Esto no es musica "+e.type),s("El archivo no es de sonido ("+e.type+")","danger")):n.canPlayType(e.type)?(o=new FileReader,o.onload=function(e){var n;return n=e.target.result,t.decodeAudioData(n,function(e){return r=e,$("#pos").attr("disabled",null),$("#pos").attr("max",r.duration),c&&p(),u()},function(e){return console.error(e),s("Ha habido un error al decodificar el sonido ("+e.message+")","danger")})},o.onprogress=function(e){return console.log(Math.round(e.loaded/e.total*100))},o.onerror=function(e){return console.error(e.target.error.code),s("El archivo no se ha podido leer ("+e.target.error.code+")","danger")},o.readAsArrayBuffer(e)):(console.error("nope "+e.type),s("El archivo de sonido no es soportado por el navegador ("+e.type+")","warning"))},u=function(e,n){var o,u,l,d,s,w,m,y;if(e=0|e,n|=r.duration-e,o=r,0!==e||n<r.duration)for(m=Math.round(e*r.sampleRate),s=Math.round(n*r.sampleRate),o=t.createBuffer(r.numberOfChannels,s,r.sampleRate),l=d=0,w=r.numberOfChannels-1;w>=0?w>=d:d>=w;l=w>=0?++d:--d)u=r.getChannelData(l),y=u.slice(m,m+s),o.copyToChannel(y,l);if(!c){switch(c=t.createBufferSource(),c.buffer=o,c.connect(soundAnalyser),c.start(),f=e,g=t.currentTime,Number($("#visualizador").val())){case 1:a();break;case 2:i()}return $("#stop").attr("disabled",null),$("#pos").attr("value",e),c.onended=function(){return c=null,p()},console.log("startPos = "+f+"\nstartTime = "+g)}},p=function(e){return c&&(c.onended=null),c&&c.stop(),d&&window.cancelAnimationFrame(d),requestAnimationFrame(function(){return o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,$("#background")[0].width,$("#background")[0].height)}),$("#stop").attr("disabled","disabled"),e!==!0&&$("#pos").attr("disabled","disabled"),console.log(e),d=c=null},i=function(){var e,n,r,a,i;return i=function(){return $("#background")[0].width},a=function(){return $("#background")[0].height},soundAnalyser.fftSize=2048,e=soundAnalyser.frequencyBinCount,n=new Uint8Array(e),o.clearRect(0,0,i(),a()),(r=function(){var u,l,s,c,p,w,m;for(d=requestAnimationFrame(r),soundAnalyser.getByteTimeDomainData(n),o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,i(),a()),o.lineWidth=4,o.strokeStyle="#3f51b5",o.beginPath(),c=1*i()/e,w=0,u=l=0,s=e;s>=0?s>=l:l>=s;u=s>=0?++l:--l)p=n[u]/128,m=p*a()/2,0===u?o.moveTo(w,m):o.lineTo(w,m),w+=c;return o.lineTo(i(),a()/2),o.stroke(),$("#pos").val(f+t.currentTime-g)})()},a=function(){var e,n,r,a,i;return i=function(){return $("#background")[0].width},a=function(){return $("#background")[0].height},soundAnalyser.fftSize=512,e=soundAnalyser.frequencyBinCount,n=new Uint8Array(e),o.clearRect(0,0,i(),a()),(r=function(){var u,l,s,c,p,w,m;for(d=requestAnimationFrame(r),soundAnalyser.getByteFrequencyData(n),o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,i(),a()),l=i()/e*2.5,m=0,w=[],s=c=0,p=e;p>=0?p>=c:c>=p;s=p>=0?++c:--c)u=a()*n[s]/256,o.fillStyle="#3f51b5",o.fillRect(m,a()-u,l,u),m+=l+1,w.push($("#pos").val(f+t.currentTime-g));return w})()},s=function(e,n){return $(".notification .alert").addClass("alert-"+n).text(e).fadeIn(500).delay(5e3).fadeOut(500,function(){return $(this).removeClass("alert-"+n)})},e=function(){var e,n,r;return n=document.createElement("canvas").getContext("2d"),r=window.devicePixelRatio||1,e=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1,r/e},e=e(),$(window).resize(function(){var n;return $("#background").width($(window).width()).height($(window).height()),n=$("#background")[0],n.width=$(window).width()*e,n.height=$(window).height()*e}),$(window).resize()}).call(this);