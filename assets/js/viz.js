(function(){var e,r,t,n,o,a,i,u,l,d,c,s,f,g,p,m,w,h;window.AudioContext=window.AudioContext||window.mozAudioContext||window.webkitAudioContext,n=n=new AudioContext,g=n.createAnalyser(),g.maxDecibels=-5,s=null,t=null,p=null,o=$("#background")[0].getContext("2d"),g.connect(n.destination),r=$("<audio/>")[0],m=0,w=0,l=null,u=!0,n.suspend(),$("#cancion").change(function(e){return e.preventDefault(),c(e.target.files[0]),!1}),$("body").on("drop",function(e){return e.stopPropagation(),e.preventDefault(),c(e.originalEvent.dataTransfer.files[0]),$(".arrastrar").stop().animate({opacity:0},500),$(".arrastrar").data("dragover",null),!1}),$("body").on("dragover",function(e){return e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.dropEffect="copy",$(".arrastrar").data("dragover")||($(".arrastrar").stop().animate({opacity:1},300),$(".arrastrar").data("dragover","yep")),!1}),$("body").on("dragleave",function(e){return e.stopPropagation(),e.preventDefault(),$(".arrastrar").stop().animate({opacity:0},500),$(".arrastrar").data("dragover",null),!1}),$("#visualizador").change(function(e){switch(s&&window.cancelAnimationFrame(s),s=null,Number($("#visualizador").val())){case 1:return a();case 2:return i()}}),$("#play").click(function(e){return d()}),$("#stop").click(function(e){return h()}),$("#pos").mousedown(function(e){return h(!0),$("#pos").attr("disabled",null),clearTimeout(l),l=null}),$("#pos").mouseup(function(e){return d(Number($("#pos").val()))}),c=function(e){var o;return console.log(e),-1===e.type.indexOf("audio/")?(console.error("Esto no es musica "+e.type),f("El archivo no es de sonido ("+e.type+")","danger")):r.canPlayType(e.type)?(o=new FileReader,o.onload=function(e){var r;return r=e.target.result,n.decodeAudioData(r,function(e){return t=e,$("#pos").attr("disabled",null),$("#pos").attr("max",t.duration),p&&h(),d()},function(e){return console.error(e),f("Ha habido un error al decodificar el sonido ("+e.message+")","danger")})},o.onprogress=function(e){return console.log(Math.round(e.loaded/e.total*100))},o.onerror=function(e){return console.error(e.target.error.code),f("El archivo no se ha podido leer ("+e.target.error.code+")","danger")},o.readAsArrayBuffer(e)):(console.error("nope "+e.type),f("El archivo de sonido no es soportado por el navegador ("+e.type+")","warning"))},d=function(e,r){var o,d,c,s,f,v,b,y;if(e=e||0,r=r||t.duration-e,o=t,0!==e||r<t.duration)for(b=Math.round(e*t.sampleRate),f=Math.round(r*t.sampleRate),o=n.createBuffer(t.numberOfChannels,f,t.sampleRate),c=s=0,v=t.numberOfChannels-1;v>=0?v>=s:s>=v;c=v>=0?++s:--s)d=t.getChannelData(c),y=d.slice(b,b+f),o.copyToChannel(y,c);if(l&&(clearTimeout(l),l=null),u&&(u=!1,n.resume(),console.log("audioCtx resumed")),!p){switch(p=n.createBufferSource(),p.buffer=o,p.connect(g),p.start(),m=e,w=n.currentTime,Number($("#visualizador").val())){case 1:a();break;case 2:i()}return $("#stop").attr("disabled",null),$("#pos").attr("value",e),p.onended=function(){return p=null,h()},console.log("startPos = "+m+"\nstartTime = "+w)}},h=function(e){return p&&(p.onended=null),p&&p.stop(),s&&window.cancelAnimationFrame(s),requestAnimationFrame(function(){return o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,$("#background")[0].width,$("#background")[0].height)}),$("#stop").attr("disabled","disabled"),e!==!0&&$("#pos").attr("disabled","disabled"),l=setTimeout(function(){return u=!0,l=null,n.suspend(),console.log("audioCtx suspended")},5e3),s=p=null},i=function(){var e,r,t,a,i;return i=function(){return $("#background")[0].width},a=function(){return $("#background")[0].height},g.fftSize=2048,e=g.frequencyBinCount,r=new Uint8Array(e),o.clearRect(0,0,i(),a()),(t=function(){var u,l,d,c,f,p,h;for(s=requestAnimationFrame(t),g.getByteTimeDomainData(r),o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,i(),a()),o.lineWidth=4,o.strokeStyle="#3f51b5",o.beginPath(),c=1*i()/e,p=0,u=l=0,d=e;d>=0?d>=l:l>=d;u=d>=0?++l:--l)f=r[u]/128,h=f*a()/2,0===u?o.moveTo(p,h):o.lineTo(p,h),p+=c;return o.lineTo(i(),a()/2),o.stroke(),$("#pos").val(m+n.currentTime-w)})()},a=function(){var e,r,t,a,i;return i=function(){return $("#background")[0].width},a=function(){return $("#background")[0].height},g.fftSize=512,e=g.frequencyBinCount,r=new Uint8Array(e),o.clearRect(0,0,i(),a()),(t=function(){var u,l,d,c,f,p,h;for(s=requestAnimationFrame(t),g.getByteFrequencyData(r),o.fillStyle="true"===(localStorage.darkmode||"false")?"#282828":"rgb(255, 255, 255)",o.fillRect(0,0,i(),a()),l=i()/e*2.5,h=0,p=[],d=c=0,f=e;f>=0?f>=c:c>=f;d=f>=0?++c:--c)u=a()*r[d]/256,o.fillStyle="#3f51b5",o.fillRect(h,a()-u,l,u),h+=l+1,p.push($("#pos").val(m+n.currentTime-w));return p})()},f=function(e,r){return $(".notification .alert").addClass("alert-"+r).text(e).fadeIn(500).delay(5e3).fadeOut(500,function(){return $(this).removeClass("alert-"+r)})},e=function(){var e,r,t;return r=document.createElement("canvas").getContext("2d"),t=window.devicePixelRatio||1,e=r.webkitBackingStorePixelRatio||r.mozBackingStorePixelRatio||r.msBackingStorePixelRatio||r.oBackingStorePixelRatio||r.backingStorePixelRatio||1,t/e},e=e(),$(window).resize(function(){var r;return $("#background").width($(window).width()).height($(window).height()),r=$("#background")[0],r.width=$(window).width()*e,r.height=$(window).height()*e}),$(window).resize()}).call(this);