(function(){var o,t;o=function(){function o(o,t){this.num=o,this.cbk=t,this.doneCalls=0}return o.prototype.done=function(){return this.doneCalls++,this.num===this.doneCalls?this.cbk():void 0},o}(),t=function(){function t(o){if(this.photosPerPage=o.photosPerPage||12,this.container=o.container||$(".gallery-container")||$("#gallery-container"),this.userId=o.userId,this.photosetId=o.photosetId,!this.userId)throw"userId is not set for FlickrGallery";if(!this.photosetId)throw"photosetId is not set for FlickrGallery";if(!this.container)throw"Container not found, select a valid one";this.page=0,this.totalPages=1,this.loadingMorePhotos=!1,this.photos=[],this.photoInfo={},this.currentPhoto=null,this._curiousPromise=null,this._setUpListeners(),this.loadMorePhotos()}return t.prototype.loadMorePhotos=function(){return this.page===this.totalPages?void this.$(".load-spin-container").hide():(this.loadingMorePhotos=!0,this.page++,flickr.photosets.getPhotos({user_id:this.userId,photoset_id:this.photosetId,per_page:this.photosPerPage,page:this.page},function(o){return function(t){var i,e,n,s,r;for(o._setHeaderImageBackground(t.photoset.primary),o.totalPages=t.photoset.pages,s=0,r=t.photoset.photo,i=0,e=r.length;e>i;i++)n=r[i],o.photos.push(n),o.$(".gallery").append($("<div/>").addClass("col-xs-6").addClass("col-sm-4").addClass("col-md-3").append($("<div/>").css({"background-image":"url("+flickr.buildPhotoUrl(n)+")"}).append($("<div/>").append($("<div/>").text(n.title).addClass("photo-title"))).data("num",o.photos.length-1).click(function(t){return t.preventDefault(),o.showPhoto(o.$(t.delegateTarget).data("num")),!1}))),s++;return $(window).resize(),o.$(".photo-overlay").find("div.next").show(),o.loadingMorePhotos=!1}}(this)))},t.prototype.showPhoto=function(o,t){return $("body").css("overflow","hidden"),this.$(".photo-overlay").find("img").attr("src",flickr.buildLargePhotoUrl(this.photos[o])),this.$(".photo-overlay").find(".image-info").find("h2").text(this.photos[o].title),this.$(".photo-overlay").removeClass("hide").addClass("show"),this.$(".buttons-container").find(".next").css("left",this.$(".image-view").width()-70),this._loadPhotoImage(this.photos[o],t),this.currentPhoto=o,0===this.currentPhoto?this.$(".photo-overlay").find("div.prev").hide():this.$(".photo-overlay").find("div.prev").show(),this.currentPhoto===this.photos.length-1?this.$(".photo-overlay").find("div.next").hide():this.$(".photo-overlay").find("div.next").show(),this.currentPhoto===this.photos.length-1&&this.page<this.totalPages&&this.loadMorePhotos(),this.page===this.totalPages?this.$(".load-spin-container").show():void 0},t.prototype.hideOverlay=function(){return this.currentPhoto=null,$("body").css("overflow","inherit"),this.$(".photo-overlay").removeClass("show"),setTimeout(function(){return this.$(".photo-overlay").addClass("hide"),this.$(".photo-overlay").find("#fecha").find("span").text(""),this.$(".photo-overlay").find("#camara").find("span").text("")},500),this.page===this.totalPages?this.$(".load-spin-container").hide():void 0},t.prototype.toggleInfoPanel=function(){return this.$(".photo-overlay").find(".image-info").hasClass("min-size")?(this.$(".photo-overlay").find(".image-info").removeClass("min-size"),this.$(".photo-overlay").find(".image-view").removeClass("max-size"),this.$(".buttons-container").find(".next").css("left",.6666666666666666*$(window).width()-70)):(this.$(".photo-overlay").find(".image-info").addClass("min-size"),this.$(".photo-overlay").find(".image-view").addClass("max-size"),this.$(".buttons-container").find(".next").css("left",$(window).width()-70))},t.prototype.nextImage=function(){return null!==this.currentPhoto&&this.currentPhoto<this.photos.length-1?this.showPhoto(this.currentPhoto+1,"next"):void 0},t.prototype.previousImage=function(){return null!==this.currentPhoto&&this.currentPhoto>0?this.showPhoto(this.currentPhoto-1,"prev"):void 0},t.prototype.zoomImage=function(){return flickr.photos.getSizes({photo_id:this.photos[this.currentPhoto].id},function(o){return function(t){var i,e,n,s,r;for(r=null,n=t.sizes.size,i=0,e=n.length;e>i;i++)if(s=n[i],"Large"===s.label)r=s;else if("Original"===s.label){r=s;break}return o.$(".zoom-container > .zoom-image-view").css({"background-image":"url("+r.source+")",width:Number(r.width),height:Number(r.height)}),o.$(".zoom-container").removeClass("hide").scrollLeft(r.width/2).scrollTop(r.height/2),o.$(".zoom-container").mousemove(function(t){var i,e,n,s;return s=$(window).width(),n=$(window).height(),i=(t.clientX-50)/(s-100),e=(t.clientY-50)/(n-100),o.$(".zoom-container").scrollLeft((r.width-s+100)*i).scrollTop((r.height-n+100)*e)})}}(this))},t.prototype.hideZoomImage=function(){return this.$(".zoom-container > .zoom-image-view").css("background-image",null),this.$(".zoom-container").addClass("hide").off("mousemove")},t.prototype._loadPhotoImage=function(t,i){var e,n,s;return s=function(o){var t,i;return"ok"===o.stat?(i=o.photo.dates.taken.split(/[-: ]/),t=new Date(i[0],i[1],i[2],i[3],i[4],i[5],0),this.$(".photo-overlay").find("#descripcion").text(o.photo.description._content).show(),this.$(".photo-overlay").find("#fecha").show().find("span").text(t.toLocaleString()),this.$(".photo-overlay").find("#enlace").find("a").attr("href",o.photo.urls.url[0]._content).show()):(this.$(".photo-overlay").find("#descripcion").hide(),this.$(".photo-overlay").find("#fecha").hide(),this.$(".photo-overlay").find("#enlace").hide())},n=function(o){var t,i,e,n,s,r,h,a,d;for(e=null,t=null,r=null,i=null,n=null,a=o.photo.exif,s=0,h=a.length;h>s;s++)d=a[s],"ExifIFD"===d.tagspace&&("ExposureTime"===d.tag&&(e=d.raw._content),"FNumber"===d.tag&&(t=d.raw._content),"ISO"===d.tag&&(r=d.raw._content),"FocalLength"===d.tag&&(i=d.raw._content),"Flash"===d.tag&&(n=d.raw._content));return"ok"===o.stat?this.$(".photo-overlay").find("#camara").show().find("span").text(o.photo.camera):this.$(".photo-overlay").find("#camara").hide(),e?this.$(".photo-overlay").find("#exposicion").show().find("span").text(e):this.$(".photo-overlay").find("#exposicion").hide(),t?this.$(".photo-overlay").find("#apertura").show().find("span").text(t):this.$(".photo-overlay").find("#apertura").hide(),r?this.$(".photo-overlay").find("#iso").show().find("span").text(r):this.$(".photo-overlay").find("#iso").hide(),i?this.$(".photo-overlay").find("#dist-focal").show().find("span").text(i):this.$(".photo-overlay").find("#dist-focal").hide(),n?n.indexOf(!0)?this.$(".photo-overlay").find("#flash").show().find("span").text("Apagado, no se disparó"):this.$(".photo-overlay").find("#flash").show().find("span").text("Encendido, se disparó"):this.$(".photo-overlay").find("#flash").hide()},e=new o(3,function(o){return function(){return s(o.photoInfo[t.id].info),n(o.photoInfo[t.id].exif),o._imageTransition(t,i),o._curiousPromise=null,o.$(".load-spin-container").removeClass("overlay-loading")}}(this)),this.$(".load-spin-container").addClass("overlay-loading"),this.$(".photo-overlay").find("img").imagesLoaded(function(o){return function(){return e.done()}}(this)),this.photoInfo[t.id]&&this.photoInfo[t.id].info?e.done():flickr.photos.getInfo({photo_id:t.id,secret:t.secret},function(o){return function(i){return o.photoInfo[t.id]?o.photoInfo[t.id].info=i:o.photoInfo[t.id]={info:i},e.done()}}(this)),this.photoInfo[t.id]&&this.photoInfo[t.id].exif?e.done():flickr.photos.getExif({photo_id:t.id,secret:t.secret},function(o){return function(i){return o.photoInfo[t.id]?o.photoInfo[t.id].exif=i:o.photoInfo[t.id]={exif:i},e.done()}}(this))},t.prototype._imageTransition=function(o,t){var i,e;return e=this.$(".photo-overlay").find(".img").css("background-image"),e&&"none"!==e?(i=t?"next"===t?"60% 50%":"40% 50%":"center",this.$(".photo-overlay").find("#img2").css({"background-image":""+e,"background-position":"center",opacity:"1",display:"block"}).parent().find("#img").css({"background-image":"url('"+flickr.buildLargePhotoUrl(o)+"')","background-position":i,opacity:"0"}),setTimeout(function(o){return function(){return new AnimationTimer(250,function(i){var e,n,s;return e=-(Math.cos(Math.PI*i)-1)/2,t?(n="next"===t?60-10*i:40+10*i,s="next"===t?50-10*i:50+10*i):n=s=50,o.$(".photo-overlay").find("#img").css({opacity:""+e,"background-position":n+"% 50%"}),o.$(".photo-overlay").find("#img2").css({opacity:""+(1-e),"background-position":s+"% 50%"})},!0).onEnd(function(){return o.$(".photo-overlay").find("#img2").hide().parent().find("#img").css("opacity","1")})}}(this),100)):this.$(".photo-overlay").find(".img").css("background-image","url('"+flickr.buildLargePhotoUrl(o)+"')")},t.prototype._setHeaderImageBackground=function(o){return"none"===this.$(".image-background").css("background-image")?flickr.photos.getSizes({photo_id:o},function(o){var t,i,e,n,s;if("ok"===o.stat){for(i=null,n=o.sizes.size,t=0,e=n.length;e>t;t++)if(s=n[t],"Large"===s.label){i=s.source;break}return this.$(".image-background").parallax({imageSrc:i})}}):void 0},t.prototype._setUpListeners=function(){return $(window).scroll(function(o){return function(){var t,i;return t=$(document).scrollTop()+$(window).height(),i=document.body.scrollHeight,100>i-t&&!o.loadingMorePhotos?o.loadMorePhotos():void 0}}(this)),$(window).resize(function(){return this.$(".gallery > div > div").each(function(o){return function(t,i){return o.$(i).height(o.$(i).width())}}(this))}),$(window).keyup(function(o){return function(t){if(o.$(".photo-overlay").hasClass("show")){if(27===t.keyCode)return o.$(".zoom-container").hasClass("hide")?o.hideOverlay():o.hideZoomImage();if(39===t.keyCode)return o.nextImage();if(37===t.keyCode)return o.previousImage();if(32===t.keyCode)return console.log(null)}}}(this)),this.$(".image-view").mousemove(function(o){return function(){return o.$(".photo-overlay").find(".buttons-container").removeClass("no-move"),o._timer.restart()}}(this)),this._timer=new Timer(3e3,function(o){return function(){return o.$(".photo-overlay").find(".buttons-container").addClass("no-move")}}(this),!0),this.$(".photo-overlay").find("#close").click(this.hideOverlay.bind(this)).parent().find("#info").click(this.toggleInfoPanel.bind(this)),this.$(".photo-overlay").find("#zoom").click(this.zoomImage.bind(this)),this.$(".photo-overlay").find("div.next").click(this.nextImage.bind(this)),this.$(".photo-overlay").find("div.prev").click(this.previousImage.bind(this)),this.$(".image-view").swipeleft(this.nextImage.bind(this)),this.$(".image-view").swiperight(this.previousImage.bind(this)),this.$(".photo-overlay").find(".zoom-image-view").mousedown(function(o){return function(t){var i,e,n,s;return n=t.pageX,s=t.pageY,i=o.$(".zoom-container").scrollLeft(),e=o.$(".zoom-container").scrollTop(),o.$(".zoom-image-view").mousemove(function(t){return o.$(".zoom-image-view").hasClass("grabbing")||o.$(".zoom-image-view").addClass("grabbing"),o.$(".zoom-container").scrollLeft(i-(t.pageX-n)),o.$(".zoom-container").scrollTop(e-(t.pageY-s))})}}(this)).mouseup(function(o){return function(t){return o.$(".zoom-image-view").off("mousemove").removeClass("grabbing")}}(this)),this.$(".photo-overlay").find(".buttons-container").tap(function(o){return function(t){return Date.now()-o._lastTap<=500?o.zoomImage():o._lastTap=Date.now()}}(this)),this.$(".photo-overlay").find(".zoom-image-view").taphold(function(o){return function(t){return o.$(".zoom-image-view").hasClass("grabbing")?void 0:o.hideZoomImage()}}(this)),this._lastTap=Date.now()},t.prototype.$=function(o){return $(this.container).find(o)},t}(),window.FlickrGallery=t,-1===window.location.origin.indexOf("localhost:4000")&&-1===window.location.origin.indexOf("melchor9000")||(window.melchordegaleria=new t({userId:"142458589@N03",photosetId:"72157667134867210",container:$(".container")}))}).call(this);